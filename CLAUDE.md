# Cooklet - 献立管理アプリ 仕様書

## 1. プロジェクト基本情報

### Claude Code AIへの制約
すべての応答は、日本語で行われなければなりません。
ソースコードには、読者の理解を助けるような日本語のコメントを書いてください。
トークン節約のために、ソースコードがあるディレクトリにはCLAUDE.mdを生成し、配下のファイルに含まれるメゾットなどを要約してください。内容はClaudeが理解できれば一任します。
ソースコードを参照するときは、まず各ディレクトリのCLAUDE.mdを参照してください。
ソースコードを変更するときは、忘れずにCLAUDE.mdにも変更を反映してください。変更した仕様はすべてこのファイルに追記・修正してください。
ユーザの応答が必要なときには、以下のコマンドでユーザの操作を促す: `echo -e '\a'`
不要なパッケージは`pnpm uninstall`してください。
実装の際は、まずこのファイルにTODOを追加し、作業が完了したらTODOを完了としてください。
不要なTODOは適宜削除してください。
変数を定義するときは必ず型を記述してください。`any`は決して使用してはいけません。
**oxlint抑制コメント（`// oxlint-disable`）は決して使用してはいけません。**根本的な型安全性とコード品質の改善で解決してください。
適宜`pnpm run lint && pnpm run build`を実行して、コードの品質を維持してください。
**【重要】Git Hook導入済み**：
- **pre-commit hook**: コミット前に自動でlintチェック実行（エラー時はコミット阻止）
- **pre-push hook**: プッシュ前に自動でlint & buildチェック実行（エラー時はプッシュ阻止）
- Git hookにより品質管理が自動化されているため、手動チェックは不要
`import`は、`import {...}`の形式を使用してください。`import ...`は使用しないでください。
Github issueに着手する前に、該当のissueに修正方針のコメントを追加してください。
Github issueの解決を確認したら、修正の概要をコメントし、Closeしてください。
変更を保存するため、キリがよく、かつ動作が確認できたタイミングで`git add . && git commit -m "wip" && git push`を実行してください。
キリのいいタイミングで、CLAUDE.mdの内容がコードベースと一致しているか確認し、不一致があれば修正してください。
画面をまたいでUIの一貫性を維持してください。
データベースの変更が必要な場合は、その旨をIssueのコメントやユーザへの返答で知らせ、database/patch-***.sqlのような形式でパッチを出力してください。

### プロジェクト概要・目的
- **アプリ名**: Cooklet
- **概要**: 一人暮らしユーザーのための献立・在庫・買い物・コストを一元管理できるスマートな献立管理Webアプリ
- **目的**: レシピはURL管理とし、軽量かつシンプルなPWAとして設計
- **対象ユーザー**: 一人暮らしで自炊する個人ユーザー、献立・在庫・支出をシンプルに記録・管理したい人

### 開発スタイル
- **個人開発**: 自分のペースで好きに開発
- **Claude Code**: AI支援による効率的な開発

### バージョン管理
- **Git**: GitHub
- **ブランチ戦略**: main（本番）/ develop（開発）
- **自動デプロイ**: GitHub連携でNetlifyに自動デプロイ

## 2. 技術アーキテクチャ

### 2.1 フロントエンド
- **React + TypeScript**
- **PWA対応**でネイティブアプリ風の体験
- **レスポンシブデザイン**（モバイルファースト）

### 2.2 バックエンド・データベース
- **Supabase（無料枠）**
  - PostgreSQLデータベース
  - 認証機能（Google連携）
  - リアルタイム機能
  - ファイルストレージ
  - 月500MBまで無料

### 2.3 ホスティング
- **Netlify（無料枠）**
  - 静的サイトホスティング
  - GitHub連携で自動デプロイ
  - カスタムドメイン対応
  - 月100GB帯域まで無料
  - PWA対応・CDN最適化

### 2.4 API設計
- **Supabase Client直接利用**
  - フロントエンドから直接SupabaseのREST APIを呼び出し
  - 認証・認可はSupabaseが自動処理
  - リアルタイム更新も簡単

```typescript
// API利用例
import { createClient } from '@supabase/supabase-js'

// 在庫取得
const { data } = await supabase.from('stock_items').select('*')

// 献立作成
const { data } = await supabase.from('meal_plans').insert({...})

// 在庫減算（ストアドプロシージャ）
await supabase.rpc('update_inventory_after_cooking', { recipe_id: 1 })
```

### 2.5 通知機能
- **Web Push API**（ブラウザ標準）
- PWAで利用可能
- 完全無料

## 3. アプリ特徴

### 3.1 主な特徴
- **レシピはURL管理**、調理手順は非保存
- **食材はLLMでURLから自動抽出**（必要に応じて手動編集）
- **中途半端な食材・作り置きにも対応**した在庫管理
- 献立と在庫から**買い物リストを自動生成**
- **一食ごとの支出記録**（自炊・外食対応）
- **Web Push通知で賞味期限リマインド**（予定）
- **UIは軽量・高速を重視**、リッチな装飾は控える

## 4. グローバルタブ構成

アプリ下部のタブバーで画面遷移：

| タブ名 | 機能概要 |
|--------|----------|
| **サマリー** | 当日の献立・在庫アラート・出費概要の一括表示 |
| **献立** | 献立の週間プランを視覚的に確認・編集（今日から7日間表示） |
| **買い物** | 食材不足に基づいた買い物リスト表示・チェック管理 |
| **レシピ** | 外部レシピURLの保存と食材抽出の編集、管理 |
| **在庫** | 現在の在庫一覧表示・編集・賞味期限管理 |
| **コスト** | 自炊・外食を含む一食単位でのコスト記録・月別集計表示 |

## 5. UI要素の画面配置仕様

### 5.1 サマリー
```
［ヘッダー］
┌─────────────────────────────────┐
│ 📊 サマリー         ⚙️    │
└─────────────────────────────────┘

［今日の献立セクション］
┌─────────────────────────────────┐
│ 📅 今日の献立 (6/15)           │
├─────────────────────────────────┤
│ 🌅 朝食: トースト + コーヒー     │
│   材料: パン1枚、バター10g      │
│   🌐 レシピを見る        ［✓］  │
├─────────────────────────────────┤
│ 🌞 昼食: ［未設定］            │
│                    ［+ 追加］   │
├─────────────────────────────────┤
│ 🌙 夕食: ハンバーグ定食        │
│   材料: 牛ひき肉200g、玉ねぎ   │
│   🌐 レシピを見る        ［編集］│
└─────────────────────────────────┘

［在庫アラートセクション］
┌─────────────────────────────────┐
│ ⚠️ 在庫アラート                │
├─────────────────────────────────┤
│ 🔴 賞味期限切れ                │
│   • にんじん (6/13期限)        │
│   • 牛乳 (6/14期限)           │
├─────────────────────────────────┤
│ 🟡 明日まで                    │
│   • たまご (6/16期限)          │
│   • ヨーグルト (6/16期限)       │
└─────────────────────────────────┘

［今月の出費セクション］
┌─────────────────────────────────┐
│ 💰 今月の出費 (6月)            │
├─────────────────────────────────┤
│ 🏠 自炊: ¥3,200 (12回)        │
│ 🍽️ 外食: ¥2,100 (3回)         │
├─────────────────────────────────┤
│ 📊 合計: ¥5,300               │
│ 📈 1日平均: ¥353              │
└─────────────────────────────────┘

［フッター］
┌─────────────────────────────────┐
│ 📊 💬 🛒 🍳 💰              │
└─────────────────────────────────┘
```

### 5.2 カレンダー画面
```
［ヘッダー］
┌─────────────────────────────────┐
│ 📅 献立カレンダー        ［⚙️］  │
│     今週 (6/14 - 6/20)          │
└─────────────────────────────────┘

［カレンダービュー］
┌─────────────────────────────────┐
│   土  日  月  火  水  木  金    │
├─────────────────────────────────┤
│  14 ［15］ 16  17  18  19  20   │
│  🍽️ 🍳🍳  🍳  🍳  🍳  🍳  🍳    │
└─────────────────────────────────┘

［選択日の詳細］
┌─────────────────────────────────┐
│ 📅 6月15日 (今日)               │
├─────────────────────────────────┤
│ 🌅 朝食: トースト              │
│    📋 材料: パン, バター        │
│    🌐 レシピを見る       ［編集］ │
├─────────────────────────────────┤
│ 🌞 昼食: ［未設定］            │
│                     ［+ 追加］  │
├─────────────────────────────────┤
│ 🌙 夕食: ハンバーグ定食        │
│    📋 材料: 牛ひき肉, 玉ねぎ    │
│    🌐 レシピを見る       ［編集］ │
└─────────────────────────────────┘

［週間サマリー］
┌─────────────────────────────────┐
│ 📊 今週の予定 (6/9 - 6/15)      │
│ 🏠 自炊: 5回  🍽️ 外食: 2回      │
│ 💰 予算: ¥1,200               │
└─────────────────────────────────┘
```

### 5.3 買い物画面
```
［ヘッダー］
┌─────────────────────────────────┐
│ 🛒 買い物リスト          ［⚙️］  │
│ 未完了: 5件  完了: 3件          │
└─────────────────────────────────┘

［新規追加］
┌─────────────────────────────────┐
│ ［食材名を入力...］        ［+］  │
│ ［数量 (任意)］                 │
└─────────────────────────────────┘

［未完了アイテム］
┌─────────────────────────────────┐
│ ☐ 牛ひき肉 (200g)    ［自動］   │
│ ☐ 玉ねぎ (1個)       ［自動］   │
│ ☐ パン              ［手動］   │
│ ☐ 牛乳 (1本)        ［自動］   │
│ ☐ レタス            ［手動］   │
│                         ［全選択］│
└─────────────────────────────────┘

［完了アイテム（折りたたみ）］
┌─────────────────────────────────┐
│ ▼ 完了済み (3件)        ［削除］ │
├─────────────────────────────────┤
│ ☑️ にんじん (2本)               │
│ ☑️ たまご (1パック)             │
│ ☑️ 醤油                       │
└─────────────────────────────────┘

［アクションボタン］
┌─────────────────────────────────┐
│ ［完了をまとめて削除］           │
│ ［在庫に追加して削除］           │
└─────────────────────────────────┘
```

### 5.4 レシピ画面
```
［ヘッダー］
┌─────────────────────────────────┐
│ 🍳 レシピ管理            ［⚙️］  │
│ 保存済み: 12件                  │
└─────────────────────────────────┘

［新規レシピ登録］
┌─────────────────────────────────┐
│ 📝 新しいレシピを追加           │
├─────────────────────────────────┤
│ ［レシピURLを入力...］    ［解析］│
│ または                          │
│ ［レシピ名を入力...］            │
└─────────────────────────────────┘

［食材自動抽出（URLの場合）］
┌─────────────────────────────────┐
│ 🔄 食材を自動抽出中...          │
│ ［ハンバーグの作り方］           │
│                                │
│ 検出された食材:                 │
│ • 牛ひき肉 ［200g］      ［編集］│
│ • 玉ねぎ   ［1個］       ［編集］│
│ • パン粉   ［適量］      ［編集］│
│                         ［保存］ │
└─────────────────────────────────┘

［保存済みレシピ一覧］
┌─────────────────────────────────┐
│ 🔍 ［検索...］           ［絞込］ │
├─────────────────────────────────┤
│ 📄 ハンバーグ定食              │
│    🌐 cookpad.com/recipe...    │
│    📋 牛ひき肉, 玉ねぎ, パン粉   │
│    🏷️ 肉料理                   │
│                   ［編集］［削除］│
├─────────────────────────────────┤
│ 📄 親子丼                     │
│    🌐 手動レシピ               │
│    📋 鶏肉, 卵, 玉ねぎ         │
│    🏷️ 丼物                    │
│                   ［編集］［削除］│
├─────────────────────────────────┤
│ 📄 トマトパスタ               │
│    🌐 recipe.rakuten.co...     │
│    📋 パスタ, トマト缶, にんにく │
│    🏷️ パスタ                  │
│                   ［編集］［削除］│
└─────────────────────────────────┘

［フィルター・ソート］
┌─────────────────────────────────┐
│ 🏷️ タグ: ［全て▼］             │
│ ⏰ 調理時間: ［指定なし▼］       │
│ 📅 並び順: ［作成日順▼］         │
└─────────────────────────────────┘
```

### 5.5 コスト画面
```
［ヘッダー］
┌─────────────────────────────────┐
│ 💰 コスト管理            ［⚙️］  │
│ ＜ 2025年6月 ＞                │
└─────────────────────────────────┘

［月間サマリー］
┌─────────────────────────────────┐
│ 📊 今月の支出                  │
├─────────────────────────────────┤
│ 🏠 自炊: ¥3,200 (12回)        │
│    └ 1回平均: ¥267            │
│ 🍽️ 外食: ¥2,100 (3回)         │
│    └ 1回平均: ¥700            │
├─────────────────────────────────┤
│ 💯 合計: ¥5,300 (15回)         │
│ 📈 1日平均: ¥353              │
│ 📈 1回平均: ¥353              │
└─────────────────────────────────┘

［新規記録］
┌─────────────────────────────────┐
│ ➕ 新しい支出を記録             │
├─────────────────────────────────┤
│ 📅 日付: ［2025/06/15］        │
│ 📝 内容: ［昼食 - 牛丼］        │
│ 💰 金額: ［   ］円             │
│ 🍽️ ☐ 外食                     │
│                         ［保存］ │
└─────────────────────────────────┘

［支出履歴］
┌─────────────────────────────────┐
│ 📋 支出履歴                    │
│ ［週間］［月間］  🔍［検索...］  │
├─────────────────────────────────┤
│ 📅 6/15 (今日)                │
│ 🏠 朝食 - トースト       ¥120  │
│                   ［編集］［削除］│
├─────────────────────────────────┤
│ 📅 6/14                       │
│ 🍽️ 夕食 - 居酒屋       ¥1,500  │
│ 🏠 昼食 - 自作弁当      ¥200   │
│                   ［編集］［削除］│
├─────────────────────────────────┤
│ 📅 6/13                       │
│ 🏠 夕食 - ハンバーグ     ¥350   │
│ 🏠 昼食 - パスタ        ¥180   │
│                   ［編集］［削除］│
└─────────────────────────────────┘

［統計・分析］
┌─────────────────────────────────┐
│ 📈 月別推移                    │
│ 4月: ¥4,800  5月: ¥5,100      │
│ 6月: ¥5,300 (進行中)           │
└─────────────────────────────────┘
```

### 5.6 共通UI要素・ダイアログ

#### 5.6.1 タブナビゲーション（下部固定）
```
［タブナビゲーション（下部固定）］
┌─────────────────────────────────┐
│ 📊      💬      🛒      🍳      💰 │
│サマリー  カレンダー 買い物  レシピ  コスト│
│                                   │
└─────────────────────────────────┘
```

#### 5.6.2 献立編集ダイアログ（サマリー・カレンダーから）
```
［献立編集ダイアログ］
┌─────────────────────────────────┐
│ ✏️ 献立を編集           ［×］    │
├─────────────────────────────────┤
│ 📅 日付: 2025/06/15 (今日)      │
│ 🕐 食事: ［夕食    ▼］          │
│                                │
│ 🍳 レシピを選択:                │
│ ┌─────────────────────────────┐  │
│ │ 🔍 ［レシピを検索...］        │  │
│ ├─────────────────────────────┤  │
│ │ ☐ ハンバーグ定食            │  │
│ │ ☐ 親子丼                   │  │
│ │ ☐ トマトパスタ             │  │
│ │ ☐ 手動入力                 │  │
│ └─────────────────────────────┘  │
│                                │
│ 👥 人数: ［2］人前              │
│                                │
│ 📝 メモ:                       │
│ ［特別な調理法やアレンジなど］   │
├─────────────────────────────────┤
│          ［キャンセル］［保存］   │
└─────────────────────────────────┘
```

#### 5.6.3 手動入力ダイアログ（上記で手動入力選択時）
```
［手動献立入力ダイアログ］
┌─────────────────────────────────┐
│ ✏️ 手動で献立入力       ［×］    │
├─────────────────────────────────┤
│ 📝 料理名:                      │
│ ［ハンバーグ定食］              │
│                                │
│ 🌐 レシピURL (任意):            │
│ ［https://cookpad.com/...］     │
│                                │
│ 👥 人数: ［2］人前              │
│                                │
│ 📋 使用する食材:                │
│ • 牛ひき肉 ［200g］      ［-］  │
│ • 玉ねぎ   ［1個］       ［-］  │
│                    ［+ 食材追加］│
│                                │
│ 📝 メモ:                       │
│ ［特別な調理法やアレンジなど］   │
├─────────────────────────────────┤
│          ［キャンセル］［保存］   │
└─────────────────────────────────┘
```

#### 5.6.4 レシピ編集ダイアログ（レシピ画面から）
```
［レシピ編集ダイアログ］
┌─────────────────────────────────┐
│ ✏️ レシピ編集           ［×］    │
├─────────────────────────────────┤
│ 📝 レシピ名:                    │
│ ［ハンバーグ定食］              │
│                                │
│ 🌐 URL:                        │
│ ［https://cookpad.com/...］     │
│                     ［食材抽出］ │
│                                │
│ 👥 人数: ［2］人前              │
│                                │
│ 📋 食材:                       │
│ • 牛ひき肉 ［200g］      ［-］  │
│ • 玉ねぎ   ［1個］       ［-］  │
│ • パン粉   ［適量］      ［-］  │
│                    ［+ 食材追加］│
│                                │
│ 🏷️ タグ: ［肉料理］             │
├─────────────────────────────────┤
│          ［キャンセル］［保存］   │
└─────────────────────────────────┘
```

#### 5.6.5 在庫編集ダイアログ（在庫アラートから）
```
［在庫編集ダイアログ］
┌─────────────────────────────────┐
│ ✏️ 在庫を編集           ［×］    │
├─────────────────────────────────┤
│ 📝 食材名:                      │
│ ［にんじん］                   │
│                                │
│ 📊 数量: ［2］［本  ▼］         │
│                                │
│ 📅 賞味期限:                    │
│ ［2025/06/20］          ［今日］ │
│                        ［1週間］ │
│                                │
│ 🏠 保存場所:                    │
│ ☐ 冷蔵庫  ☐ 冷凍庫  ☐ 常温    │
│                                │
│ 🍱 作り置き: ☐ はい             │
├─────────────────────────────────┤
│    ［削除］    ［キャンセル］［保存］│
└─────────────────────────────────┘
```

#### 5.6.6 コスト記録ダイアログ（コスト画面から）
```
［コスト記録ダイアログ］
┌─────────────────────────────────┐
│ ✏️ 支出を記録           ［×］    │
├─────────────────────────────────┤
│ 📅 日付: ［2025/06/15］  ［今日］│
│                                │
│ 📝 内容:                       │
│ ［昼食 - 牛丼］                │
│                                │
│ 💰 金額: ［500］円              │
│                                │
│ 🍽️ ☑️ 外食                     │
│ 🏠 ☐ 自炊                      │
│                                │
│ 📝 メモ (任意):                 │
│ ［すき家で食べた］              │
├─────────────────────────────────┤
│    ［削除］    ［キャンセル］［保存］│
└─────────────────────────────────┘
```

#### 5.6.7 削除確認ダイアログ
```
［削除確認ダイアログ］
┌─────────────────────────────────┐
│ ⚠️ 確認                ［×］    │
├─────────────────────────────────┤
│                                │
│ 「ハンバーグ定食」を削除します。 │
│                                │
│ この操作は取り消せません。       │
│                                │
├─────────────────────────────────┤
│          ［キャンセル］［削除］   │
└─────────────────────────────────┘
```

## 6. データベース設計

Supabase（PostgreSQL）を使用。

### 6.1 meal_plans（献立）
```sql
-- 献立（1日ごとの記録）
meal_plans (
  id: UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id: UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  date: DATE NOT NULL,
  meal_type: TEXT NOT NULL,      -- 朝 / 昼 / 夜 / 間食
  recipe_url: TEXT,
  ingredients: JSONB,            -- [{ name, quantity }]
  memo: TEXT,
  created_at: TIMESTAMP DEFAULT NOW(),
  updated_at: TIMESTAMP DEFAULT NOW()
)
```

### 6.2 stock_items（食材在庫）
```sql
-- 食材在庫
stock_items (
  id: UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id: UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name: TEXT NOT NULL,
  quantity: TEXT NOT NULL,
  best_before: DATE,
  storage_location: TEXT,
  is_homemade: BOOLEAN DEFAULT FALSE,
  created_at: TIMESTAMP DEFAULT NOW(),
  updated_at: TIMESTAMP DEFAULT NOW()
)
```

### 6.3 shopping_list（買い物リスト）
```sql
-- 買い物リスト
shopping_list (
  id: UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id: UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name: TEXT NOT NULL,
  quantity: TEXT,
  checked: BOOLEAN DEFAULT FALSE,
  added_from: TEXT,              -- manual / auto
  created_at: TIMESTAMP DEFAULT NOW()
)
```

### 6.4 cost_records（コスト記録）
```sql
-- コスト記録
cost_records (
  id: UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id: UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  date: DATE NOT NULL,
  description: TEXT,
  amount: INTEGER NOT NULL,
  is_eating_out: BOOLEAN DEFAULT FALSE,
  created_at: TIMESTAMP DEFAULT NOW()
)
```

### 6.5 saved_recipes（レシピ保存）
```sql
-- レシピ保存
saved_recipes (
  id: UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id: UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title: TEXT NOT NULL,
  url: TEXT NOT NULL,
  servings: INTEGER DEFAULT 1,    -- 何人前
  tags: TEXT[],
  created_at: TIMESTAMP DEFAULT NOW()
)
```

### 6.6 インデックス設計
```sql
-- パフォーマンス向上のためのインデックス
CREATE INDEX idx_meal_plans_user_date ON meal_plans(user_id, date);
CREATE INDEX idx_stock_items_user_best_before ON stock_items(user_id, best_before);
CREATE INDEX idx_shopping_list_user_checked ON shopping_list(user_id, checked);
CREATE INDEX idx_cost_records_user_date ON cost_records(user_id, date);
```

## 7. UI/UX設計

### 7.1 デザインシステム
- **軽量でシンプルなデザイン**
- **Material Icons**を使用
- **レスポンシブグリッド**システム
- **アニメーション**による滑らかなUI遷移
- **高速表示を重視**、リッチな装飾は控える

### 7.2 TypeScript型定義例
```typescript
// 基本型定義
interface MealPlan {
  id: string;
  user_id: string;
  date: string;
  meal_type: '朝' | '昼' | '夜' | '間食';
  recipe_url?: string;
  ingredients: { name: string; quantity: string }[];
  memo?: string;
  created_at: string;
  updated_at: string;
}

interface StockItem {
  id: string;
  user_id: string;
  name: string;
  quantity: string;
  best_before?: string;
  storage_location?: string;
  is_homemade: boolean;
  created_at: string;
  updated_at: string;
}

interface ShoppingListItem {
  id: string;
  user_id: string;
  name: string;
  quantity?: string;
  checked: boolean;
  added_from: 'manual' | 'auto';
  created_at: string;
}

interface CostRecord {
  id: string;
  user_id: string;
  date: string;
  description: string;
  amount: number;
  is_eating_out: boolean;
  created_at: string;
}

interface SavedRecipe {
  id: string;
  user_id: string;
  title: string;
  url: string;
  servings: number;
  tags: string[];
  created_at: string;
}
```

## 8. 開発・運用計画

### 8.1 開発手順・優先順位

**フェーズ1：基本CRUD機能**
1. 認証機能（Google連携）
2. 在庫管理（追加・編集・削除）
3. レシピ管理（URL保存、食材抽出）
4. 献立計画（カレンダー表示）
5. 買い物リスト（基本機能）

**フェーズ2：自動化機能**
1. LLMによる食材自動抽出
2. 献立からの買い物リスト自動生成
3. 賞味期限管理・アラート

**フェーズ3：コスト・通知機能**
1. コスト管理機能
2. 通知システム（Web Push API）
3. PWA対応
4. パフォーマンス最適化

### 8.2 UI/UXデザインルール

#### 8.2.1 ダイアログ統一デザイン
**基本方針**：在庫管理ダイアログを基準とした統一デザイン

**適用対象**：
- レシピ追加・編集ダイアログ
- 在庫追加・編集ダイアログ
- 買い物リスト項目編集ダイアログ
- コスト記録ダイアログ

**共通UI要素**：
1. **ダイアログサイズ**: 中サイズ（max-w-lg）
2. **ヘッダー構成**: タイトル + 閉じるボタン（×）
3. **ボタン配置**: 下部3段階配置
   - 左側: 削除ボタン（編集時のみ表示）
   - 右側: キャンセル・保存ボタン
4. **入力フィールド**: ラベル + 入力欄の縦並び
5. **カラーリング**: 削除ボタンは赤色（bg-red-500）

#### 8.2.2 リスト画面からの削除ボタン禁止
**禁止事項**：
- レシピ一覧での削除ボタン表示
- 買い物リスト項目での削除ボタン表示
- 在庫一覧での削除ボタン表示

**削除操作の正しい配置**：
- 各項目の編集ダイアログ内に削除ボタンを配置
- 削除確認ダイアログとの連携
- 誤操作防止のための2段階削除

#### 8.2.3 設定アイコン（⚙️）使用ルール
**使用可能箇所**：
- ヘッダー右端の設定アイコンのみ（将来の設定画面遷移用）

**使用禁止箇所**：
- 各画面内でのアクションボタン
- リスト項目内での操作ボタン
- ダイアログ内での機能ボタン

**代替案**：
- 編集: ［編集］テキストボタン
- 詳細: 項目タップによる詳細表示
- その他操作: 適切なテキストラベル使用

#### 8.2.4 操作フローの統一
**基本フロー**：
1. 一覧画面で項目をタップ → 詳細表示または編集ダイアログ
2. 編集ダイアログで ［編集］ → 入力可能状態
3. 編集ダイアログで ［削除］ → 削除確認ダイアログ
4. 新規追加は各画面上部の ［+ 追加］ボタン

**例外ルール**：
- 買い物リストのチェック操作は項目上で直接実行
- サマリーからの直接編集は維持

#### 8.2.5 共通ボタンコンポーネント使用ルール（issue #16対応）
**必須使用コンポーネント**：
- `EditButton`: 編集ボタン（在庫画面ベースデザイン）
- `AddButton`: 追加ボタン
- `DeleteButton`: 削除ボタン（ダイアログ内のみ）

**使用箇所**：
- 在庫管理画面のアクションボタン
- コスト管理画面の支出履歴編集ボタン
- レシピ管理画面の編集ボタン
- 各種ダイアログ内のボタン

**禁止事項**：
- 独自のボタンスタイル作成禁止
- インライン編集・削除ボタンの追加禁止

**コンポーネント仕様**：
- 詳細は `/src/components/ui/CLAUDE.md` を参照
- 在庫画面の編集ボタンを基準とした統一デザイン

### 8.3 MVP（最小機能）の定義
- 基本的な献立・在庫・買い物・コスト管理機能
- レシピURL管理と食材管理
- 個人利用に最適化された機能セット

### 8.4 テスト戦略
- **単体機能テスト**：各機能の動作確認
- **手動テスト**：実際の使用シーンでの動作確認
- **TypeScript**による型安全性の確保

### 8.5 デプロイメント手順
1. **ローカル開発**：`pnpm run dev`
2. **ビルド**：`pnpm run build`
3. **自動デプロイ**：GitHub pushでGitHub Pagesに自動デプロイ
4. **データベース**：Supabaseのマイグレーション管理
5. **CI/CD**：GitHub Actionsによる自動ビルド・デプロイ

## 9. セキュリティ・パフォーマンス

### 9.1 データ保護方針
- **Google連携ログイン**による認証
- **個人利用**のため最小限のセキュリティ対策
- **機微情報を含まない**データ設計
- **Supabase Row Level Security**による基本的なデータ保護

### 9.2 パフォーマンス要件
- **モバイルファースト**の軽量設計
- **必要最小限のデータ取得**
- **画像最適化**
- **PWA対応**によるオフライン機能

## 10. 環境構築

### 10.1 開発環境
```bash
# プロジェクト作成
pnpm create vite@latest cooklet -- --template react-ts
cd cooklet

# 依存関係インストール
pnpm install @supabase/supabase-js
pnpm install @types/react @types/react-dom
pnpm install tailwindcss postcss autoprefixer
pnpm install @headlessui/react
pnpm install date-fns
pnpm install react-calendar
pnpm install lucide-react

# 開発サーバー起動
pnpm run dev
```

### 10.2 環境変数
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 10.3 Supabase設定
```typescript
// lib/supabase.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseKey)
```

## 11. 今後の拡張性

### 11.1 将来的な機能追加
- **バーコードスキャン**による在庫登録

### 11.2 技術的な拡張性
- **モバイルアプリ**化（React Native）
- **外部API連携**（栄養価データベース等）

## 12. PWA・サービスワーカー機能

### 12.1 サービスワーカー更新機能

アプリの新しいバージョンが利用可能になった場合の自動更新システムを実装。

#### 12.1.1 更新検知フロー
1. **updatefound**イベントでサービスワーカーの更新を検知
2. 新しいサービスワーカーが**installed**状態になったらユーザーに通知
3. ユーザーが承認すると**skipWaiting()**で即座に更新
4. **controllerchange**イベントでページリロード

#### 12.1.2 実装ファイル
- `/public/sw.js`: サービスワーカー本体
- `/src/App.tsx`: 更新通知UI

#### 12.1.3 サービスワーカー機能
```javascript
// メッセージ処理
self.addEventListener('message', event => {
  if (event.data && event.data.type === 'SKIP_WAITING') {
    self.skipWaiting(); // 新しいバージョンに更新
  }
});

// バージョン情報取得
if (event.data && event.data.type === 'GET_VERSION') {
  const version = CACHE_NAME.split('-')[1];
  event.ports[0].postMessage({ type: 'VERSION_INFO', version });
}
```

#### 12.1.4 アプリ側実装
```typescript
// 更新検知
registration.addEventListener('updatefound', () => {
  const newWorker = registration.installing;
  newWorker.addEventListener('statechange', () => {
    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
      // ユーザー確認ダイアログ表示
      setNewServiceWorker(newWorker);
      setIsPWAUpdateDialogOpen(true);
    }
  });
});

// 更新実行
const handleConfirmPWAUpdate = () => {
  newServiceWorker.postMessage({ type: 'SKIP_WAITING' });
  // controllerchangeイベントで自動リロード
};
```

#### 12.1.5 ユーザー体験
- **非破壊的更新**: ユーザーの承認なしには更新しない
- **明確な通知**: 「🔄 アプリ更新」ダイアログで新機能を案内
- **選択可能**: 「今すぐ更新」「後で更新」のオプション提供
- **自動リロード**: skipWaiting後は自動でページリロード

#### 12.1.6 技術的特徴
- **installイベント**: 自動skipWaitingは無効化（ユーザー制御）
- **エラーハンドリング**: 更新失敗時のログ出力
- **状態管理**: React useState でダイアログ状態管理
- **メッセージ通信**: ServiceWorkerとメインスレッド間の双方向通信

### 12.2 PWA基本機能
- **オフライン対応**: キャッシュ戦略による基本機能提供
- **プッシュ通知**: 賞味期限アラート（将来実装）
- **アプリライク体験**: インストール可能なWebアプリ
