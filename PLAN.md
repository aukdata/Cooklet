# Quantity型の演算に関する要求仕様

## 1. 概要

`Quantity`型は、アプリケーション全体で食材の数量を表すために使用される。現在の実装では、`amount`プロパティは文字列型であり、数値だけでなく「適量」や「少々」といった表現も許容している。また、単位(`unit`)も多様である。

このドキュメントでは、`Quantity`型同士の加算・減算を可能にするための仕様を定義する。これにより、在庫管理の精度向上や、買い物リストの自動生成機能の強化を目指す。

## 2. 背景

- **在庫管理:** ユーザーが購入した食材を在庫に追加（加算）したり、料理で使用した分を在庫から消費（減算）したりする際に、正確な数量計算が必要となる。
- **買い物リスト:** 献立に必要な食材の総量から、現在の在庫量を差し引く（減算）ことで、不足分を自動的に買い物リストに追加する機能に必要となる。

## 3. `Quantity`型の現状

- **定義:**
  ```typescript
  export interface Quantity {
    amount: string;
    unit: string;
  }
  ```
- **`amount`に取りうる値:**
  - 数値文字列: "100", "2", "0.5"
  - 分数表現: "1/2", "1/4"
  - 混合数表現: "2+1/2"
  - 漢数字・範囲表現: "少々", "適量", "ひとつまみ"
- **`unit`に取りうる値:**
  - 基本単位: "g", "kg", "ml", "l", "個", "本", "枚"
  - 調理単位: "大さじ", "小さじ", "カップ"
  - その他の単位: "缶", "パック", "束", "房", "かけ", "人分"
  - 単位をつけない: "-"

## 4. 要求仕様

### 4.1. 数量の正規化

- **目的:** 演算可能な数値形式に変換する。
- **仕様:**
  - `amount`の文字列を数値に変換するパーサーを実装する。
    - "100" -> `100`
    - "0.5" -> `0.5`
    - "1/2" -> `0.5`
    - "2+1/2" -> `2.5`
  - 「適量」「少々」などの非数値表現は、特定のルールに基づき数値に変換するか、あるいは演算対象外として扱う。まずは`0`として扱うことを検討する。

### 4.2. 単位の変換

- **目的:** 異なる単位間での演算を可能にする。
- **仕様:**
  - 単位変換テーブルを定義する。
    - `g` <-> `kg` (1kg = 1000g)
    - `ml` <-> `l` (1l = 1000ml)
    - `大さじ` <-> `ml` (大さじ1 = 15ml)
    - `小さじ` <-> `ml` (小さじ1 = 5ml)
    - `カップ` <-> `ml` (1カップ = 200ml)
  - 変換不可能な単位同士の演算は`null`を返す。
    - 例: `1個 + 100g` -> `null`
  - まずは、重量(g, kg)と体積(ml, l, 大さじ, 小さじ, カップ)の基本的な単位変換を実装する。
  - **結果の単位:** より小さい単位（この場合は`g`）に合わせる。

### 4.3. 加算・減算ロジック

- **目的:** `Quantity`オブジェクト同士の加算・減算を行う関数を実装する。
- **仕様:**
  - `add(q1: Quantity, q2: Quantity): Quantity | null`
  - `subtract(q1: Quantity, q2: Quantity): Quantity | null`
  - **処理フロー:**
    1. 各`Quantity`の`amount`を正規化する。
    2. 単位を比較し、必要であれば変換可能な基本単位（例：`g`や`ml`）に揃える。
    3. 単位が揃えられない場合は、`null`を返す。
    4. 数値の加算・減算を行う。
    5. 結果を`Quantity`オブジェクトとして返す。単位は計算に使用した基本単位とする。

### 4.4. 実装方針

1. **数量パーサーの実装:** `amount`文字列を数値に変換するユーティリティ関数を作成する。
2. **単位変換テーブルの定義:** `src/constants/units.ts` などに単位変換情報を定義する。
3. **単位変換ロジックの実装:** 単位変換を行うユーティリティ関数を作成する。
4. **演算関数の実装:** `add`および`subtract`関数を`src/utils/quantityUtils.ts`（新規作成）に実装する。
5. **テスト:** 上記の各機能について、十分なテストケースを作成し、`src/test/`配下に配置する。特に、エッジケース（非数値、単位不一致など）を網羅する。
