# Pages/Shopping ディレクトリ

## 概要
買い物リスト機能のページコンポーネントを管理するディレクトリ。CLAUDE.md仕様書5.3に完全準拠。

## ファイル構成

### Shopping.tsx
買い物リスト表示・管理を行うページコンポーネント - CLAUDE.md仕様書5.3に準拠した完全実装。

#### 実装済み機能

**ヘッダー表示**
- 買い物リストタイトル（🛒アイコン付き）
- 未完了・完了件数のリアルタイム表示
- 設定ボタン（⚙️）

**新規アイテム追加**
- 食材名入力フィールド
- 数量入力フィールド（任意）
- 追加ボタン（+）
- フォームバリデーション

**レシート読み取り機能**
- レシートから追加ボタン（📄アイコン付き）
- 画像ファイルアップロード機能
- モック画像認識処理（2秒のシミュレート）
- ファイル妥当性チェック（JPEG/PNG、10MB以下）
- 読み取り結果を完了状態で自動追加
- トースト通知による結果表示

**未完了アイテム表示**
- チェックボックス付きアイテム一覧
- 食材名と数量の表示
- 自動/手動ラベル表示（色分け）
- 全選択/全解除ボタン
- 空状態メッセージ

**完了アイテム表示**
- 折りたたみ可能なセクション
- チェック済みアイテムの一覧表示
- 取り消し線スタイリング
- 完了件数表示

**一括操作機能**
- 全選択/全解除機能
- 完了アイテム一括削除
- **完了アイテムを在庫に追加（スマートマージ機能付き）**
  - 既存在庫との自動マージ
  - 同名アイテムの数量自動加算
  - 商品名正規化機能統合
  - 詳細なマージ結果レポート

#### 状態管理

**ローカル状態**
- `newItemName`: 新規追加する食材名
- `newItemQuantity`: 新規追加する数量
- `showCompleted`: 完了アイテム表示状態
- `selectAll`: 全選択状態
- `editingQuantities`: 完了アイテムの量編集状態
- `shoppingItems`: 買い物リストアイテム配列

**データ型定義**
```typescript
interface ShoppingItem {
  id: string;
  name: string;
  quantity?: string;
  checked: boolean;
  added_from: 'manual' | 'auto';
}
```

#### 機能詳細

**アイテム管理**
- 新規追加（handleAddItem）
- チェック状態変更（handleToggleItem）
- 一括削除（handleDeleteCompleted）
- 完了アイテムの量編集（handleQuantityEdit）
- 完了アイテムの在庫追加（handleAddToStock）

**レシート読み取り**
- ファイル選択（handleReceiptButtonClick）
- 画像アップロード処理（handleReceiptUpload）
- レシート認識結果の追加（handleAddReceiptItems）
- ファイル妥当性チェック（validateImageFile）
- 読み取り状態管理（isReadingReceipt）

**UI操作**
- 折りたたみ表示制御
- 全選択ロジック
- レスポンシブデザイン

**サンプルデータ**
- 8件のサンプルアイテム
- 未完了5件、完了3件
- 自動/手動の混在データ

#### UI設計

**カード型レイアウト**
- 新規追加フォーム
- 未完了アイテムリスト
- 完了アイテムリスト（折りたたみ）
- アクションボタン群

**視覚的識別**
- 自動生成: 青色ラベル（bg-blue-100）
- 手動追加: グレーラベル（bg-gray-100）
- 完了アイテム: 取り消し線
- 折りたたみ: ▶/▼アイコン

**インタラクション**
- ホバー効果
- チェックボックスのタッチ対応
- ボタンの状態変化

#### 今後の実装予定

**データ統合**
- useShoppingListフック作成
- Supabase shopping_listテーブル連携
- リアルタイムデータ更新

**自動生成機能**
- 献立からの買い物リスト自動生成
- 在庫との突合による必要数量計算
- meal_plansとstock_itemsの連携

**在庫連携（完了済み）**
- 在庫追加機能の実装完了
- stock_itemsテーブルとの連携完了
- 完了アイテムの在庫自動登録完了
- 量調整エディット機能完了

## 注意点
- CLAUDE.md仕様書5.3に完全準拠の実装完了
- 現在はサンプルデータを使用（実DB連携は今後実装）
- 自動生成機能の実装には複雑なビジネスロジックが必要
- 在庫管理機能との密接な連携が必要
- アイコンは絵文字を使用（Material Iconsではない）
- モバイルファーストのレスポンシブデザイン