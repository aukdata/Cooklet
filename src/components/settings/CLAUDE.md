# Components/Settings ディレクトリ

## 概要
設定機能に関連するコンポーネントを管理するディレクトリ。Settingsページのリファクタリングにより分離されたコンポーネント群。

## ファイル構成

### NotificationSettings.tsx
通知設定コンポーネント - 朝の時間指定通知の有効/無効切り替えと時間設定を管理するコンポーネント。

#### 実装済み機能

**朝の通知管理**
- 通知の有効/無効切り替え
- 通知時間の設定（HH:MM形式）
- ブラウザ通知権限の要求・確認
- 設定状態のリアルタイム表示

**データベース連携**
- users テーブルとの完全連携
- notification_enabled フラグの管理
- notification_time の時間設定
- 設定変更の即座反映

**通知サービス統合**
- notificationService との連携
- 通知スケジュールの自動管理
- 設定変更時の再スケジューリング
- 無効化時のスケジュールクリア

#### Props

```typescript
interface NotificationSettingsProps {
  /** Supabaseユーザー情報 */
  supabaseUser: User | null;
}
```

#### 内部状態管理

**ローカル状態**
- `morningNotificationTime`: 通知時間（デフォルト: '08:00'）
- `morningNotificationEnabled`: 通知有効状態
- `isLoading`: 設定変更処理中状態

**副作用（useEffect）**
- ユーザーIDが変更された時の設定読み込み
- 初期化時の通知スケジュール設定

#### 主要機能

**handleEnableMorningNotification**
- 通知権限の確認・要求
- データベースへの設定保存
- 通知スケジュールの開始
- ユーザーフィードバック

**handleDisableMorningNotification**
- データベースでの無効化
- 通知スケジュールのクリア
- 状態の更新

**handleMorningTimeChange**
- 時間変更のデータベース保存
- アクティブな通知の再スケジューリング
- 即座の設定反映

#### UI設計

**設定カード形式**
- 白背景のカード型レイアウト
- 🌅 朝の通知アイコン
- 設定状態の明確な表示

**インタラクティブ要素**
- 有効/無効切り替えボタン
- 時間選択input（time type）
- 設定状態のリアルタイム表示

**状態に応じた表示**
- 有効時：緑色の「無効にする」ボタン
- 無効時：緑色の「有効にする」ボタン
- 処理中：ボタンの無効化

**情報表示**
- 現在の設定状態表示
- 機能説明テキスト
- 設定変更の成功/失敗フィードバック

#### エラーハンドリング

**権限関連エラー**
- ブラウザ通知権限拒否時の適切なメッセージ
- 権限要求の再試行促進

**データベースエラー**
- 設定保存失敗時のエラー表示
- ユーザーへの明確なフィードバック

**ネットワークエラー**
- 接続エラー時の適切な処理
- 再試行促進メッセージ

#### 通知フロー

**初期化時**
1. ユーザーIDでデータベースから設定読み込み
2. 有効な場合は自動でスケジュール設定
3. UI状態の更新

**有効化時**
1. ブラウザ通知権限の確認・要求
2. データベースへの設定保存
3. notificationService でのスケジュール設定
4. ユーザーへの成功通知

**時間変更時**
1. 新しい時間のデータベース保存
2. 有効な場合は再スケジューリング
3. 即座のUI更新

#### リファクタリング効果

**責任の分離**
- Settings.tsx から約100行の複雑なロジックを分離
- 朝の通知機能に特化した単一責任コンポーネント

**再利用性向上**
- 他の設定画面でも朝の通知設定を利用可能
- 独立したコンポーネントとしての柔軟性

**テスタビリティ向上**
- 単一機能のユニットテストが容易
- モックしやすいプロップス設計

#### 使用例

```typescript
// Settings.tsxでの使用例
<NotificationSettings
  supabaseUser={supabaseUser}
/>
```

#### 依存関係

**外部サービス**
- notificationService: 通知スケジュール管理
- supabase: データベース操作
- useToast: ユーザーフィードバック

**データベーステーブル**
- users テーブルの notification_enabled, notification_time カラム

## 注意点
- ブラウザの通知権限が必要
- PWA環境での動作が前提
- タイムゾーンはユーザーのローカル時間で動作
- Service Worker での通知管理が理想的だが、現在は setTimeout ベース
- users テーブルの該当カラムが存在する必要がある